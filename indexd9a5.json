{"id":600,"date":"2014-07-08T10:39:54","date_gmt":"2014-07-08T02:39:54","guid":{"rendered":"http:\/\/ijz.me\/?p=600"},"modified":"2014-07-08T10:39:54","modified_gmt":"2014-07-08T02:39:54","slug":"nginx%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1upstream%e9%85%8d%e7%bd%ae","status":"publish","type":"post","link":"http:\/\/ijz.me\/?p=600","title":{"rendered":"nginx\u8d1f\u8f7d\u5747\u8861upstream\u914d\u7f6e"},"content":{"rendered":"<p>nginx\u505a\u4e3a\u4e00\u4e2a\u5f3a\u5927\u7684\u53cd\u5411\u4ee3\u7406\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u7f13\u5b58\u5df2\u7ecf\u88ab\u5e7f\u6cdb\u4f7f\u7528\uff0c\u4eca\u7279\u5bf9\u5176\u8d1f\u8f7d\u5747\u8861upstream\u914d\u7f6e\u505a\u4e00\u4e2a\u603b\u7ed3:<\/p>\n<p><!--more--><\/p>\n<p><strong>\u7b2c\u4e00\u79cd\uff1a\u8f6e\u8be2<\/strong><\/p>\n<div class=\"codecolorer-container text default\" style=\"width: 435px; overflow: auto; white-space: nowrap;\">\n<div class=\"text codecolorer\">upstream ijz{<br \/>\nserver 192.168.0.1:3000;<br \/>\nserver 192.168.0.1:3001;<br \/>\n}<\/div>\n<\/div>\n<p><strong>\u7b2c\u4e8c\u79cd\uff1a\u6743\u91cd<\/strong><\/p>\n<div class=\"codecolorer-container text default\" style=\"width: 435px; overflow: auto; white-space: nowrap;\">\n<div class=\"text codecolorer\">upstream ijz{<br \/>\nserver 192.168.0.1 weight=2;<br \/>\nserver 192.168.0.2 weight=3;<br \/>\n}<\/div>\n<\/div>\n<p>\u8fd9\u79cd\u6a21\u5f0f\u53ef\u89e3\u51b3\u670d\u52a1\u5668\u6027\u80fd\u4e0d\u7b49\u7684\u60c5\u51b5\u4e0b\u8f6e\u8be2\u6bd4\u7387\u7684\u8c03\u914d<\/p>\n<p><strong>\u7b2c\u4e09\u79cd\uff1aip_hash<\/strong><\/p>\n<div class=\"codecolorer-container text default\" style=\"width: 435px; overflow: auto; white-space: nowrap;\">\n<div class=\"text codecolorer\">upstream ijz{<br \/>\nip_hash;<br \/>\nserver 192.168.0.1;<br \/>\nserver 192.168.0.2;<br \/>\n}<\/div>\n<\/div>\n<p>\u8fd9\u79cd\u6a21\u5f0f\u4f1a\u6839\u636e\u6765\u6e90IP\u548c\u540e\u7aef\u914d\u7f6e\u6765\u505ahash\u5206\u914d\uff0c\u786e\u4fdd\u56fa\u5b9aIP\u53ea\u8bbf\u95ee\u4e00\u4e2a\u540e\u7aef<\/p>\n<p><strong>\u7b2c\u56db\u79cd\uff1afair<\/strong><\/p>\n<p>\u9700\u8981\u5b89\u88c5<a href=\"http:\/\/wiki.nginx.org\/HttpUpstreamFairModule\" target=\"_blank\">Upstream Fair Balancer<\/a> Module<\/p>\n<div class=\"codecolorer-container text default\" style=\"width: 435px; overflow: auto; white-space: nowrap;\">\n<div class=\"text codecolorer\">upstream ijz{<br \/>\nserver 192.168.0.1;<br \/>\nserver 192.168.0.2;<br \/>\nfair;<br \/>\n}<\/div>\n<\/div>\n<p>\u8fd9\u79cd\u6a21\u5f0f\u4f1a\u6839\u636e\u540e\u7aef\u670d\u52a1\u7684\u54cd\u5e94\u65f6\u95f4\u6765\u5206\u914d\uff0c\u54cd\u5e94\u65f6\u95f4\u77ed\u7684\u540e\u7aef\u4f18\u5148\u5206\u914d<\/p>\n<p><strong>\u7b2c\u4e94\u79cd\uff1a\u81ea\u5b9a\u4e49hash<\/strong><\/p>\n<p>\u9700\u8981\u5b89\u88c5<a href=\"http:\/\/wiki.nginx.org\/HttpUpstreamRequestHashModule\" target=\"_blank\">Upstream Hash<\/a> Module<\/p>\n<div class=\"codecolorer-container text default\" style=\"width: 435px; overflow: auto; white-space: nowrap;\">\n<div class=\"text codecolorer\">upstream ijz{<br \/>\nserver 192.168.0.1;<br \/>\nserver 192.168.0.2;<br \/>\nhash $request_uri;<br \/>\n}<\/div>\n<\/div>\n<p>\u8fd9\u79cd\u6a21\u5f0f\u53ef\u4ee5\u6839\u636e\u7ed9\u5b9a\u7684\u5b57\u7b26\u4e32\u8fdb\u884cHash\u5206\u914d<\/p>\n<p><strong>\u5177\u4f53\u5e94\u7528\uff1a<\/strong><\/p>\n<div class=\"codecolorer-container text default\" style=\"width: 435px; overflow: auto; white-space: nowrap;\">\n<div class=\"text codecolorer\">server{<br \/>\nlisten 80;<br \/>\nserver_name .ijz.me;<br \/>\ncharset utf-8;location \/ {<br \/>\nproxy_pass http:\/\/ijz\/;<br \/>\n}<br \/>\n}<\/div>\n<\/div>\n<p>&nbsp;<\/p>\n<p><strong>\u6b64\u5916upstream\u6bcf\u4e2a\u540e\u7aef\u7684\u53ef\u8bbe\u7f6e\u53c2\u6570\u4e3a\uff1a<\/strong><\/p>\n<p>1.down: \u8868\u793a\u6b64\u53f0server\u6682\u65f6\u4e0d\u53c2\u4e0e\u8d1f\u8f7d\u3002<\/p>\n<p>2.weight: \u9ed8\u8ba4\u4e3a1\uff0cweight\u8d8a\u5927\uff0c\u8d1f\u8f7d\u7684\u6743\u91cd\u5c31\u8d8a\u5927\u3002<\/p>\n<p>3.max_fails: \u5141\u8bb8\u8bf7\u6c42\u5931\u8d25\u7684\u6b21\u6570\u9ed8\u8ba4\u4e3a1.\u5f53\u8d85\u8fc7\u6700\u5927\u6b21\u6570\u65f6\uff0c\u8fd4\u56deproxy_next_upstream\u6a21\u5757\u5b9a\u4e49\u7684\u9519\u8bef\u3002<\/p>\n<p>4.fail_timeout: max_fails\u6b21\u5931\u8d25\u540e\uff0c\u6682\u505c\u7684\u65f6\u95f4\u3002<\/p>\n<p>5.backup: \u5176\u5b83\u6240\u6709\u7684\u975ebackup\u673a\u5668down\u6216\u8005\u5fd9\u7684\u65f6\u5019\uff0c\u8bf7\u6c42backup\u673a\u5668\uff0c\u5e94\u6025\u9876\u66ff\u3002<\/p>\n","protected":false},"excerpt":{"rendered":"<p>nginx\u505a\u4e3a\u4e00\u4e2a\u5f3a\u5927\u7684\u53cd\u5411\u4ee3\u7406\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u7f13\u5b58\u5df2\u7ecf\u88ab\u5e7f\u6cdb\u4f7f\u7528\uff0c\u4eca\u7279\u5bf9\u5176\u8d1f\u8f7d\u5747\u8861upstream\u914d\u7f6e\u505a\u4e00\u4e2a\u603b\u7ed3 [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[7],"tags":[38],"class_list":["post-600","post","type-post","status-publish","format-standard","hentry","category-tools","tag-nginx"],"_links":{"self":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/600","targetHints":{"allow":["GET"]}}],"collection":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=600"}],"version-history":[{"count":0,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/600\/revisions"}],"wp:attachment":[{"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=600"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=600"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=600"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}