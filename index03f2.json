{"id":54,"date":"2013-11-30T00:00:00","date_gmt":"2013-11-29T16:00:00","guid":{"rendered":"http:\/\/ijz.me\/?p=54"},"modified":"2013-11-30T00:00:00","modified_gmt":"2013-11-29T16:00:00","slug":"plsql%e4%b8%8et-sql%e7%9a%84%e5%8c%ba%e5%88%ab","status":"publish","type":"post","link":"http:\/\/ijz.me\/?p=54","title":{"rendered":"PL\/SQL\u4e0eT-SQL\u7684\u533a\u522b"},"content":{"rendered":"<p>PL\/SQL\u4e5f\u662f\u4e00\u79cd\u7a0b\u5e8f\u8bed\u8a00\uff0c\u53eb\u505a\u8fc7\u7a0b\u5316SQL\u8bed\u8a00\uff08Procedural Language\/SQL\uff09\u3002PL\/SQL\u662fOracle\u6570\u636e\u5e93\u5bf9SQL\u8bed\u53e5\u7684\u6269\u5c55\u3002\u5728\u666e\u901aSQL\u8bed\u53e5\u7684\u4f7f\u7528\u4e0a\u589e\u52a0\u4e86\u7f16\u7a0b\u8bed\u8a00\u7684\u7279\u70b9\uff0c\u6240\u4ee5PL\/SQL\u5c31 \u662f\u628a\u6570\u636e\u64cd\u4f5c\u548c\u67e5\u8be2\u8bed\u53e5\u7ec4\u7ec7\u5728PL\/SQL\u4ee3\u7801\u7684\u8fc7\u7a0b\u6027\u5355\u5143\u4e2d\uff0c\u901a\u8fc7\u903b\u8f91\u5224\u65ad\u3001\u5faa\u73af\u7b49\u64cd\u4f5c\u5b9e\u73b0\u590d\u6742\u7684\u529f\u80fd\u6216\u8005\u8ba1\u7b97\u7684\u7a0b\u5e8f\u8bed\u8a00\u3002<\/p>\n<p><!--more--><\/p>\n<p>T-SQL\u662f\u5fae\u8f6f\u5bf9SQL \u7a0b\u5f0f\u8bbe\u8ba1\u8bed\u8a00\u7684\u589e\u5f3a\u7248\uff0c\u5b83\u662f\u7528\u6765\u8ba9\u5e94\u7528\u7a0b\u5f0f\u4e0e SQL Server \u6c9f\u901a\u7684\u4e3b\u8981\u8bed\u8a00\u3002T-SQL \u63d0\u4f9b\u6807\u51c6 SQL\u7684DDL \u548c DML \u529f\u80fd\uff0c\u52a0\u4e0a\u5ef6\u4f38\u7684\u51fd\u6570\u3001\u7cfb\u7edf\u9884\u5b58\u7a0b\u5e8f\u4ee5\u53ca\u7a0b\u5f0f\u8bbe\u8ba1\u7ed3\u6784(\u4f8b\u5982 IF \u548c WHILE)\u8ba9\u7a0b\u5f0f\u8bbe\u8ba1\u66f4\u6709\u5f39\u6027\u3002<br \/>\n\u4e24\u8005\u5728\u5404\u4e2a\u65b9\u9762\u8fd8\u662f\u6709\u7740\u6bd4\u8f83\u5927\u7684\u533a\u522b\u7684\uff0c\u4e0b\u9762\u5bf9\u4e24\u8005\u505a\u4e2a\u6bd4\u8f83\u603b\u7ed3\u65b9\u4fbf\u5927\u5bb6\u5b66\u4e60\uff1a<img decoding=\"async\" src=\"http:\/\/www_qibosoft_com\/Tmp_updir\/article\/43\/1_aiugyoC_0003.gif\" alt=\"\" \/><\/p>\n<p><strong>\u5b57\u7b26\u4e32\u8fde\u63a5<\/strong><\/p>\n<p>Oracle\u7528|| \u7b26\u53f7\u4f5c\u4e3a\u8fde\u63a5\u7b26\uff0c\u800cSQL Server\u7684\u8fde\u63a5\u7b26\u662f\u52a0\u53f7\uff1a+ \u3002<br \/>\nOracle\u67e5\u8be2\u5982\u4e0b\u6240\u793a\uff1aSelect \u2018Name\u2019 || \u2018Last Name\u2019 From tableName<br \/>\nSQL Server\u67e5\u8be2\u5982\u4e0b\uff1aSelect \u2018Name\u2019 + \u2018Last Name\u2019<\/p>\n<p><strong>GUID<\/strong><\/p>\n<p>Oracle\u7528SYS_GUID()\u751f\u6210GUID\uff0c\u4e0d\u542b{}\u548c-\uff1bgetregguidstring \u751f\u6210 GUID \u542b{}\u548c-\uff1b<\/p>\n<p>SQL Server\u7528NEWID\u751f\u6210GUID\uff1b<\/p>\n<p><strong>\u6570\u5b57\u53d6\u820d<\/strong><br \/>\nOracle\u6570\u636e\u5e93\u5185\u6709\u4e00\u4e2aTRUNC\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u8fd4\u56dem\u4f4d\u5341\u8fdb\u5236\u6570\u7684n\u4f4d\uff1b\u5982\u679c\u7701\u7565m\u5219n\u5c31\u662f0\u4f4d\u3002m\u7684\u503c\u53ef\u4ee5\u4e3a\u8d1f\uff0c\u8868\u793a\u622a\u53bb\u5c0f\u6570\u70b9\u5de6\u8fb9m\u4f4d\u6570\u5b57\u3002<br \/>\n\u5728SQL Server\u4e0b\u53ef\u4ee5\u7528Round\u6216\u8005Floor\u3002Oracle\u67e5\u8be2\u5982\u4e0b\u6240\u793a\uff1aSELECT\u00a0\u00a0TRUNC(15.79,1) &#8220;Truncate&#8221; FROM DUAL;<br \/>\nSQL Server\u67e5\u8be2\u5982\u4e0b\uff1aSELECT ROUND(15.79, 0) rounded , ROUND(15.79, 0,1) truncated<br \/>\nSELECT FLOOR(ROUND(15.79, 0)), FLOOR(ROUND(15.79, 0,1) )<\/p>\n<p><strong>\u6570\u5b57\u8f6c\u6362<\/strong><br \/>\nOracle\u7684TO_CHAR\u51fd\u6570\u53ef\u4ee5\u628an\u4f4dNUMBER\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u4e3aVARCHAR2 \u6570\u636e\u7c7b\u578b\uff0c\u540c\u65f6\u91c7\u7528\u53ef\u9009\u7684\u6570\u5b57\u683c\u5f0f\u3002<br \/>\nSQL Server\u5219\u901a\u8fc7STR\u51fd\u6570\u8fd4\u56de\u6570\u5b57\u8f6c\u6362\u4e4b\u540e\u7684\u5b57\u7b26\u6570\u636e\u3002\u4e0d\u8fc7\uff0c\u8be5\u51fd\u6570\u4e0d\u5177\u65b9\u4fbf\u7684Format\u53c2\u6570\u3002<br \/>\nOracle\u67e5\u8be2\u5982\u4e0b\u6240\u793a\uff1aSELECT to_char(123.45 ,99999999999999) from tab<br \/>\nSELECT to_char(EXPIRY_DATE,&#8217;DDMONYYYY&#8217;) from tab<br \/>\nSQL Server\u67e5\u8be2\u5982\u4e0b\uff1aSELECT STR(123.45, 14)<br \/>\nSELECT STR(round(123.455 , 2),12,2)<br \/>\nSELECT CAST(REPLACE((CONVERT(varchar(12) , EXPIRYDATE, 106 )),&#8217; &#8216; , &#8221;) as varchar(9))<\/p>\n<p><strong>LENGTH<\/strong><strong>\u548cLEN<\/strong><br \/>\nOracle\u67e5\u8be2\u5982\u4e0b\u6240\u793a\uff1aSELECT LENGTH(&#8216;SQLMAG&#8217;) &#8220;Length in characters&#8221; FROM DUAL;<br \/>\nSQL Server\u67e5\u8be2\u5982\u4e0b\uff1aSELECT LEN(&#8216;SQLMAG&#8217;) &#8220;Length in characters&#8221;<\/p>\n<p><strong>\u65e5\u671f<\/strong><br \/>\n\u4e24\u79cd\u7cfb\u7edf\u90fd\u5177\u6709\u5404\u81ea\u7684\u5f53\u524d\u65e5\u671f\u548c\u65f6\u95f4\u683c\u5f0f\u3002<br \/>\nOracle\u53d6\u5f97\u65e5\u671f\u548c\u91c7\u7528\u5982\u4e0b\u65b9\u5f0f\uff1aSYSDATE<br \/>\nSQL Server\u5219\u662f\u8fd9\u6837\u7684\uff1aGETDATE()<br \/>\n\u4f60\u53ef\u4ee5\u7528\u5404\u79cd\u8bed\u6cd5\u64cd\u4f5c\u65e5\u671f\u3002<\/p>\n<p>\u4ee5\u4e0b\u7684\u4ee3\u7801\u5bf9Oracle\u65e5\u671f\u503c\u4e2d\u7684\u6708\u4efd\u8fdb\u884c\u4e86\u683c\u5f0f\u8c03\u6574\uff08\u8fd4\u56de\u65e5\u671f\u518d\u52a0\u4e0an\u6708\uff09\uff1aSelect\u00a0 \u00a0add_months(sysdate,12) from dual<br \/>\nSQL Server\u5219\u662f\u5982\u4e0b\u5b8c\u6210\u540c\u7b49\u529f\u80fd\u7684\uff1aSelect dateadd(mm,12,getdate())<br \/>\n\u6570\u636e\u7684\u51cf\u6cd5\u4e5f\u4e0d\u540c\u3002<\/p>\n<p>Oracle\u4e2d\u76f4\u63a5\u5bf9\u6570\u636e\u8fdb\u884c\u51cf\u6cd5\u64cd\u4f5c\uff1aSELECT sysdate -add_months(sysdate,12) FROM dual<br \/>\nSQL Server\u5219\u662f\u8fd9\u6837\u505a\u7684\uff1aSELECT\u00a0\u00a0datediff(dd, GetDate(),dateadd(mm,12,getdate()))<\/p>\n<p><strong>\u6267\u884c\u67e5\u8be2\u65f6<\/strong><br \/>\nPLSQL\u6267\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0cFROM\u5b50\u53e5\u662f\u5fc5\u987b\u7684\uff0c\u800cSQL SERVER\u4e0d\u4e00\u5b9a<br \/>\n\u5982ORACLE\u4e2dselect 2*5 from dual<br \/>\n\u800cSQL SERVER\u4e2dselect 2*5<\/p>\n<p style=\"text-align: left;\">\n<p style=\"text-align: left;\"><strong>\u66f4\u65b0\u8bed\u53e5\u7684\u533a\u522b<\/strong><\/p>\n<p style=\"text-align: left;\">SQLserver\u4e0eOralce\u4e2d\u7684\u4e24\u8868\u5173\u8054\u66f4\u65b0\u662f\u533a\u522b\u7684\u3002<\/p>\n<p style=\"text-align: left;\">\u5728T-SQL\u4e2d\u66f4\u65b0\u76f8\u5bf9\u7b80\u5355\u4e9b\uff0c\u76f4\u63a5\u7528\u4e0b\u9762\u7684\u8bed\u53e5\u90fd\u662f\u53ef\u4ee5\uff1a<\/p>\n<p style=\"text-align: left;\">Update b<br \/>\nSet b.processflag = a.processflag<br \/>\nFrom temp_1 a Join temp_2 b<br \/>\nOn a.msgid_db = b.msgid<\/p>\n<p style=\"text-align: left;\">Update temp_2<br \/>\nSet Usertime = b.Usertime<br \/>\nFrom temp_2 a Join temp_1 b<br \/>\nOn a.msgid = b.msgid_db<\/p>\n<p style=\"text-align: left;\">Update temp_2<br \/>\nSet Usertime = b.Usertime<br \/>\nFrom temp_1 b<br \/>\nwhere msgid = b.msgid_db<\/p>\n<p style=\"text-align: left;\">PL\/SQL\u4e2d\u5e94\u8be5\u8fd9\u6837\u8868\u8fbe\uff1a<\/p>\n<p style=\"text-align: left;\">Update Temp_2 a<br \/>\nSet a.Usertime = (Select b.Usertime<br \/>\nFrom Temp_1 b<br \/>\nWhere b.Msgid_Db = a.Msgid)<br \/>\nWhere Exists (Select 1 From Temp_1 b Where b.Msgid_Db = a.Msgid);<\/p>\n<p style=\"text-align: left;\"><strong>\u66f4\u65b0\u591a\u4e2a\u5b57\u6bb5\uff1a<\/strong><\/p>\n<p style=\"text-align: left;\">Update Temp_2 a<br \/>\nSet a.Usertime = (Select b.Usertime<br \/>\nFrom Temp_1 b<br \/>\nWhere b.Msgid_Db = a.Msgid),<br \/>\na.processflag = (Select b.processflag<br \/>\nFrom Temp_1 b<br \/>\nWhere b.Msgid_Db = a.Msgid)<br \/>\nWhere Exists (Select 1 From Temp_1 b Where b.Msgid_Db = a.Msgid);<\/p>\n<p style=\"text-align: left;\"><strong>\u591a\u8868\u5173\u7cfb\u66f4\u65b0\uff1a<\/strong><\/p>\n<p style=\"text-align: left;\">Update Temp_2 a<br \/>\nSet a.Usertime = (Select b.Usertime<br \/>\nFrom Temp_1 b<br \/>\nWhere b.Msgid_Db = a.Msgid),<br \/>\na.processflag = (Select c.processflag<br \/>\nFrom Temp_3 c<br \/>\nWhere c.Msgid = a.Msgid)<br \/>\nWhere Exists (Select 1 From Temp_1 b Where b.Msgid_Db = a.Msgid)<br \/>\nAnd Exists (Select 1 From Temp_3 c Where c.Msgid = a.Msgid);<\/p>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>PL\/SQL\u4e5f\u662f\u4e00\u79cd\u7a0b\u5e8f\u8bed\u8a00\uff0c\u53eb\u505a\u8fc7\u7a0b\u5316SQL\u8bed\u8a00\uff08Procedural Language\/SQL\uff09\u3002PL\/S [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[8],"tags":[],"class_list":["post-54","post","type-post","status-publish","format-standard","hentry","category-database"],"_links":{"self":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/54","targetHints":{"allow":["GET"]}}],"collection":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=54"}],"version-history":[{"count":0,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/54\/revisions"}],"wp:attachment":[{"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=54"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=54"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=54"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}