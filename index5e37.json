{"id":810,"date":"2015-12-01T21:31:33","date_gmt":"2015-12-01T13:31:33","guid":{"rendered":"http:\/\/ijz.me\/?p=784"},"modified":"2015-12-01T21:31:33","modified_gmt":"2015-12-01T13:31:33","slug":"rex-advent-rex%e6%93%8d%e4%bd%9ciptables","status":"publish","type":"post","link":"http:\/\/ijz.me\/?p=810","title":{"rendered":"rex advent \u2014\u2014rex\u64cd\u4f5ciptables"},"content":{"rendered":"<p>\u6ce8\u610f\u9700\u8981\u5f15\u5165iptables\u5305<\/p>\n<p>use Rex::Commands::Iptables;<\/p>\n<p>&nbsp;<\/p>\n<p>1\u3001\u8fdc\u7a0b\u4e3b\u673aiptables\u5f00\u653e\u60c5\u51b5<\/p>\n<pre class=\"lang:default decode:true \">task \"ipc\", group =&gt; \"all\", sub {\n\n my $str=q(iptables -n -L);\n my $output= run $str;\n say connection-&gt;server.\": $output\";\n\n};<\/pre>\n<p><!--more--><\/p>\n<p>2\u3001rex\u8fdc\u7a0b\u6279\u91cf\u7ed9iptables\u52a0\u9ed1\u540d\u5355<\/p>\n<pre class=\"lang:default decode:true\">task \"ipb\",group =&gt; \"all\", sub {\n\niptables I=&gt;\"INPUT\", s =&gt; \"60.173.26.35\",j =&gt; \"DROP\";\niptables I=&gt;\"INPUT\", s =&gt; \"180.131.56.9\",j =&gt; \"DROP\";\n\n\nsay connection-&gt;server.\" ip ban  success!\";\n\n };<\/pre>\n<p>3\u3001\u4ecerex\u4eceiptables\u4e2d\u5220\u9664ip\u7684\u6761\u76ee<\/p>\n<pre class=\"lang:default decode:true\"> task \"ipd\", group =&gt; \"all\", sub {\n\n my $str=q(service iptables status|perl -lane 'print $F[0] if \/180.131.56.9\/');\n my $output= run $str;\n             run \"iptables -D INPUT $output\";\n say connection-&gt;server;\n};<\/pre>\n<p>4\u3001iptables\u9650\u5236sshd\u7aef\u53e3\uff0822\uff09\u767b\u5f55\uff0c\u4ec5\u4ec5\u5f00\u653e\u767d\u540d\u5355ip\u3002<\/p>\n<pre class=\"lang:default decode:true\">task \"bansshd\",group =&gt; \"all\", sub {\n\niptables A=&gt;\"INPUT\", s =&gt; \"192.168.1.0\/24\",p=&gt;'tcp',dport=&gt;22,j =&gt; \"ACCEPT\";\niptables A=&gt;\"INPUT\", s =&gt; \"172.16.2.88\",p=&gt;'tcp',dport=&gt;22,j =&gt; \"ACCEPT\";\niptables A=&gt;\"INPUT\",p=&gt;'tcp',dport=&gt;\"22\",j =&gt; \"DROP\";\n\nsay connection-&gt;server.\" sshd ban  success!\";\n\n };<\/pre>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>\u6ce8\u610f\u9700\u8981\u5f15\u5165iptables\u5305 use Rex::Commands::Iptables; &nbsp; 1\u3001\u8fdc [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[21,23],"tags":[29,34,40,44],"class_list":["post-810","post","type-post","status-publish","format-standard","hentry","category-perl","category-rex","tag-advent","tag-iptables","tag-perl","tag-rex"],"_links":{"self":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/810","targetHints":{"allow":["GET"]}}],"collection":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=810"}],"version-history":[{"count":0,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/810\/revisions"}],"wp:attachment":[{"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=810"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=810"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=810"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}