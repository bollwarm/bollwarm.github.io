{"id":122,"date":"2013-11-30T00:00:00","date_gmt":"2013-11-29T16:00:00","guid":{"rendered":"http:\/\/ijz.me\/?p=122"},"modified":"2013-11-30T00:00:00","modified_gmt":"2013-11-29T16:00:00","slug":"%e6%80%bb%e7%bb%93mysql%e7%9a%84%e4%bc%98%e5%8c%96zz","status":"publish","type":"post","link":"http:\/\/ijz.me\/?p=122","title":{"rendered":"\u603b\u7ed3MYSQL\u7684\u4f18\u5316\/zz\/"},"content":{"rendered":"<p>\u672c\u6587\u8f7d\u81ea\uff1a<a href=\"http:\/\/blog.chinaunix.net\/u\/29134\/showart_264480.html\">http:\/\/blog.chinaunix.net\/u\/29134\/showart_264480.html<\/a><\/p>\n<p>1.\u6570\u636e\u5e93\u7684\u8bbe\u8ba1<br \/>\n\u5c3d\u91cf\u628a\u6570\u636e\u5e93\u8bbe\u8ba1\u7684\u66f4\u5c0f\u7684\u5360\u78c1\u76d8\u7a7a\u95f4.<br \/>\n1).\u5c3d\u53ef\u80fd\u4f7f\u7528\u66f4\u5c0f\u7684\u6574\u6570\u7c7b\u578b.(mediumint\u5c31\u6bd4int\u66f4\u5408\u9002).<br \/>\n2).\u5c3d\u53ef\u80fd\u7684\u5b9a\u4e49\u5b57\u6bb5\u4e3anot null,\u9664\u975e\u8fd9\u4e2a\u5b57\u6bb5\u9700\u8981null.\uff08\u8fd9\u4e2a\u89c4\u5219\u53ea\u9002\u5408\u5b57\u6bb5\u4e3aKEY\u7684\u60c5\u5f62\uff09<br \/>\n3).\u5982\u679c\u6ca1\u6709\u7528\u5230\u53d8\u957f\u5b57\u6bb5\u7684\u8bdd\u6bd4\u5982varchar,\u90a3\u5c31\u91c7\u7528\u56fa\u5b9a\u5927\u5c0f\u7684\u7eaa\u5f55\u683c\u5f0f\u6bd4\u5982char.\uff08CHAR \u603b\u662f\u6bd4VARCHR\u5feb\uff09<\/p>\n<p><!--more--><br \/>\n4).\u8868\u7684\u4e3b\u7d22\u5f15\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u77ed.\u8fd9\u6837\u7684\u8bdd\u6bcf\u6761\u7eaa\u5f55\u90fd\u6709\u540d\u5b57\u6807\u5fd7\u4e14\u66f4\u9ad8\u6548.<br \/>\n5).\u53ea\u521b\u5efa\u786e\u5b9e\u9700\u8981\u7684\u7d22\u5f15\u3002\u7d22\u5f15\u6709\u5229\u4e8e\u68c0\u7d22\u8bb0\u5f55\uff0c\u4f46\u662f\u4e0d\u5229\u4e8e\u5feb\u901f\u4fdd\u5b58\u8bb0\u5f55\u3002\u5982\u679c\u603b\u662f\u8981\u5728\u8868\u7684\u7ec4\u5408\u5b57\u6bb5\u4e0a\u505a\u641c\u7d22\uff0c\u90a3\u4e48\u5c31\u5728\u8fd9\u4e9b\u5b57\u6bb5\u4e0a\u521b\u5efa\u7d22\u5f15\u3002\u7d22\u5f15\u7684\u7b2c\u4e00\u90e8\u5206\u5fc5\u987b\u662f\u6700\u5e38\u4f7f\u7528\u7684\u5b57\u6bb5.\u5982\u679c\u603b\u662f\u9700\u8981\u7528\u5230\u5f88\u591a\u5b57\u6bb5\uff0c\u9996\u5148\u5c31\u5e94\u8be5\u591a\u590d\u5236\u8fd9\u4e9b\u5b57\u6bb5\uff0c\u4f7f\u7d22\u5f15\u66f4\u597d\u7684\u538b\u7f29\u3002<br \/>\n\uff08\u8fd9\u6761\u53ea\u9002\u5408MYISAM\u5f15\u64ce\u7684\u8868\uff0c\u5bf9\u4e8eINNODB\u5219\u5728\u4fdd\u5b58\u8bb0\u5f55\u7684\u65f6\u5019\u5173\u7cfb\u4e0d\u5927\uff0c\u56e0\u4e3aINNODB\u662f\u4ee5\u4e8b\u52a1\u4e3a\u57fa\u7840\u7684\uff0c\u5982\u679c\u60f3\u5feb\u901f\u4fdd\u5b58\u8bb0\u5f55\u7684\u8bdd\uff0c\u7279\u522b\u662f\u5927\u6279\u91cf\u7684\u5bfc\u5165\u8bb0\u5f55\u7684\u65f6\u5019\uff09<br \/>\n6).\u6240\u6709\u6570\u636e\u90fd\u5f97\u5728\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u524d\u8fdb\u884c\u5904\u7406\u3002<br \/>\n7).\u6240\u6709\u5b57\u6bb5\u90fd\u5f97\u6709\u9ed8\u8ba4\u503c\u3002<br \/>\n8).\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b,\u628a\u4e00\u4e2a\u9891\u7e41\u626b\u63cf\u7684\u8868\u5206\u6210\u4e24\u4e2a\u901f\u5ea6\u4f1a\u5feb\u597d\u591a\u3002\u5728\u5bf9\u52a8\u6001\u683c\u5f0f\u8868\u626b\u63cf\u4ee5\u53d6\u5f97\u76f8\u5173\u8bb0\u5f55\u65f6\uff0c\u5b83\u53ef\u80fd\u4f7f\u7528\u66f4\u5c0f\u7684\u9759\u6001\u683c\u5f0f\u8868\u7684\u60c5\u51b5\u4e0b\u66f4\u662f\u5982\u6b64\u3002<br \/>\n(\u5177\u4f53\u7684\u8868\u73b0\u4e3a\uff1aMYISAM\u8868\u7684MERGE103f\u7c7b\u578b\uff0c\u4ee5\u53caMYISAM\u548cINNODB\u901a\u7528\u7684\u5206\u533a\uff0c\u8be6\u60c5\u89c1\u624b\u518c)<br \/>\n9).\u4e0d\u4f1a\u7528\u5230\u5916\u952e\u7ea6\u675f\u7684\u5730\u65b9\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528\u5916\u952e\u3002<br \/>\n2.\u7cfb\u7edf\u7684\u7528\u9014<br \/>\n1).\u53ca\u65f6\u7684\u5173\u95ed\u5bf9MYSQL\u7684\u8fde\u63a5\u3002<br \/>\n2).explain \u590d\u6742\u7684SQL\u8bed\u53e5\u3002\uff08\u8fd9\u6837\u80fd\u786e\u5b9a\u4f60\u7684SELECT \u8bed\u53e5\u600e\u4e48\u4f18\u5316\u6700\u4f73\uff09<br \/>\n3).\u5982\u679c\u4e24\u4e2a\u5173\u8054\u8868\u8981\u505a\u6bd4\u8f83\u8bdd\uff0c\u505a\u6bd4\u8f83\u7684\u5b57\u6bb5\u5fc5\u987b\u7c7b\u578b\u548c\u957f\u5ea6\u90fd\u4e00\u81f4.\uff08\u5728\u6570\u636e\u5e9e\u5927\u7684\u65f6\u5019\u5efa\u7acbINDEX\uff09<br \/>\n4).LIMIT\u8bed\u53e5\u5c3d\u91cf\u8981\u8ddforder by\u6216\u8005 distinct.\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u505a\u4e00\u6b21full table scan.<br \/>\n5).\u5982\u679c\u60f3\u8981\u6e05\u7a7a\u8868\u7684\u6240\u6709\u7eaa\u5f55,\u5efa\u8bae\u7528truncate table tablename\u800c\u4e0d\u662fdelete from tablename.<br \/>\n\u4e0d\u8fc7\u6709\u4e00\u4e2a\u95ee\u9898\uff0ctruncate \u4e0d\u4f1a\u5728\u4e8b\u52a1\u5904\u7406\u4e2d\u56de\u6eda\u3002\u56e0\u4e3a\u5979\u8981\u8c03\u7528create table \u8bed\u53e5\u3002<br \/>\n\uff08Truncate Table \u8bed\u53e5\u5148\u5220\u9664\u8868\u7136\u540e\u518d\u91cd\u5efa\uff0c\u8fd9\u4e2a\u662f\u5c5e\u4e8e\u6587\u4ef6\u754c\u522b\u7684\uff0c\u6240\u4ee5\u81ea\u7136\u5febN\u591a\uff09<br \/>\n\u5b9e\u6d4b\u4f8b\u5b50\uff1a<br style=\"color: #cc3333;\" \/>song2\u4e3aINNODB\u8868\u3002<br style=\"color: #cc3333;\" \/>mysql&gt; select count(1) from song2;<br style=\"color: #cc3333;\" \/>+&#8212;&#8212;&#8212;-+<br style=\"color: #cc3333;\" \/>| count(1) |<br style=\"color: #cc3333;\" \/>+&#8212;&#8212;&#8212;-+<br style=\"color: #cc3333;\" \/>|\u00a0\u00a0 500000 |<br style=\"color: #cc3333;\" \/>+&#8212;&#8212;&#8212;-+<br style=\"color: #cc3333;\" \/>1 row in set (0.91 sec)<br style=\"color: #cc3333;\" \/><br style=\"color: #cc3333;\" \/>mysql&gt; delete from song2;<br style=\"color: #cc3333;\" \/>Query OK, 500000 rows affected (15.70 sec)<br style=\"color: #cc3333;\" \/>mysql&gt; truncate table song2;<br style=\"color: #cc3333;\" \/>Query OK, 502238 rows affected (0.17 sec)<br style=\"color: #cc3333;\" \/><br style=\"color: #cc3333;\" \/>mysql&gt;<br \/>\n{<br style=\"color: #009902;\" \/>\u8fd9\u4e00\u70b9\u624b\u518c\u4e0a\u6709\u8be6\u7ec6\u89e3\u91ca\uff1a<\/p>\n<p><a name=\"truncate\"><\/a>13.2.9. TRUNCATE\u8bed\u6cd5<a name=\"id2910732\"><\/a>TRUNCATE [TABLE] <em>tbl_name<\/em><\/p>\n<p>TRUNCATE TABLE\u7528\u4e8e\u5b8c\u5168\u6e05\u7a7a\u4e00\u4e2a\u8868\u3002\u4ece\u903b\u8f91\u4e0a\u8bf4\uff0c\u8be5\u8bed\u53e5\u4e0e\u7528\u4e8e\u5220\u9664\u6240\u6709\u884c\u7684DELETE\u8bed\u53e5\u7b49\u540c\uff0c\u4f46\u662f\u5728\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4e24\u8005\u5728\u4f7f\u7528\u4e0a\u6709\u6240\u4e0d\u540c\u3002<\/p>\n<p>\u5bf9\u4e8eInnoDB\u8868\uff0c\u5982\u679c\u6709\u9700\u8981\u5f15\u7528\u8868\u7684\u5916\u952e\u9650\u5236\uff0c\u5219TRUNCATE TABLE\u88ab\u6620\u5c04\u5230DELETE\u4e0a\uff1b\u5426\u5219\u4f7f\u7528\u5feb\u901f\u5220\u51cf\uff08\u53d6\u6d88\u548c\u91cd\u65b0\u521b\u5efa\u8868\uff09\u3002\u4f7f\u7528TRUNCATE TABLE\u91cd\u65b0\u8bbe\u7f6eAUTO_INCREMENT\u8ba1\u6570\u5668\uff0c\u8bbe\u7f6e\u65f6\u4e0d\u8003\u8651\u662f\u5426\u6709\u5916\u952e\u9650\u5236\u3002<\/p>\n<p>\u5bf9\u4e8e\u5176\u5b83\u5b58\u50a8\u5f15\u64ce\uff0c\u5728MySQL 5.1\u4e2d\uff0cTRUNCATE TABLE\u4e0eDELETE FROM\u6709\u4ee5\u4e0b\u51e0\u5904\u4e0d\u540c\uff1a<\/p>\n<p>\u00b7\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u5220\u51cf\u64cd\u4f5c\u4f1a\u53d6\u6d88\u5e76\u91cd\u65b0\u521b\u5efa\u8868\uff0c\u8fd9\u6bd4\u4e00\u884c\u4e00\u884c\u7684\u5220\u9664\u884c\u8981\u5feb\u5f88\u591a\u3002<\/p>\n<p>\u00b7\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u5220\u51cf\u64cd\u4f5c\u4e0d\u80fd\u4fdd\u8bc1\u5bf9\u4e8b\u52a1\u662f\u5b89\u5168\u7684\uff1b\u5728\u8fdb\u884c\u4e8b\u52a1\u5904\u7406\u548c\u8868\u9501\u5b9a\u7684\u8fc7\u7a0b\u4e2d\u5c1d\u8bd5\u8fdb\u884c\u5220\u51cf\uff0c\u4f1a\u53d1\u751f\u9519\u8bef\u3002<\/p>\n<p>\u00b7\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u88ab\u5220\u9664\u7684\u884c\u7684\u6570\u76ee\u6ca1\u6709\u88ab\u8fd4\u56de\u3002<\/p>\n<p>\u00b7\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u53ea\u8981\u8868\u5b9a\u4e49\u6587\u4ef6<em>tbl_name<\/em>.frm\u662f\u5408\u6cd5\u7684\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528TRUNCATE TABLE\u628a\u8868\u91cd\u65b0\u521b\u5efa\u4e3a\u4e00\u4e2a\u7a7a\u8868\uff0c\u5373\u4f7f\u6570\u636e\u6216\u7d22\u5f15\u6587\u4ef6\u5df2\u7ecf\u88ab\u7834\u574f\u3002<\/p>\n<p>\u00b7\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u8868\u7ba1\u7406\u7a0b\u5e8f\u4e0d\u8bb0\u5f97\u6700\u540e\u88ab\u4f7f\u7528\u7684AUTO_INCREMENT\u503c\uff0c\u4f46\u662f\u4f1a\u4ece\u5934\u5f00\u59cb\u8ba1\u6570\u3002\u5373\u4f7f\u5bf9\u4e8eMyISAM\u548cInnoDB\u4e5f\u662f\u5982\u6b64\u3002MyISAM\u548cInnoDB\u901a\u5e38\u4e0d\u518d\u6b21\u4f7f\u7528\u5e8f\u5217\u503c\u3002<\/p>\n<p>\u00b7\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u5f53\u88ab\u7528\u4e8e\u5e26\u5206\u533a\u7684\u8868\u65f6\uff0cTRUNCATE TABLE\u4f1a\u4fdd\u7559\u5206\u533a\uff1b\u5373\uff0c\u6570\u636e\u548c\u7d22\u5f15\u6587\u4ef6\u88ab\u53d6\u6d88\u5e76\u91cd\u65b0\u521b\u5efa\uff0c\u540c\u65f6\u5206\u533a\u5b9a\u4e49\uff08.par\uff09\u6587\u4ef6\u4e0d\u53d7\u5f71\u54cd\u3002<\/p>\n<p>TRUNCATE TABLE\u662f\u5728MySQL\u4e2d\u91c7\u7528\u7684\u4e00\u4e2aOracle SQL\u6269\u5c55\u3002<\/p>\n<p><br style=\"color: #009902;\" \/>}<br \/>\n6).\u80fd\u4f7f\u7528STORE PROCEDURE \u6216\u8005 USER FUNCTION\u7684\u65f6\u5019.\uff08ROUTINE\u603b\u662f\u51cf\u5c11\u4e86\u670d\u52a1\u5668\u7aef\u7684\u5f00\u9500\uff09<br \/>\n7).\u5728\u4e00\u6761insert\u8bed\u53e5\u4e2d\u91c7\u7528\u591a\u91cd\u7eaa\u5f55\u63d2\u5165\u683c\u5f0f.\u800c\u4e14\u4f7f\u7528load data infile\u6765\u5bfc\u5165\u5927\u91cf\u6570\u636e\uff0c\u8fd9\u6bd4\u5355\u7eaf\u7684indert\u5feb\u597d\u591a.\uff08\u5728MYSQL\u4e2d\u5177\u4f53\u8868\u73b0\u4e3a\uff1aINSERT INTO TABLEQ VALUES (),(),&#8230;();\uff09<br \/>\n\uff08\u8fd8\u6709\u5c31\u662f\u5728MYISAM\u8868\u4e2d\u63d2\u5165\u5927\u91cf\u8bb0\u5f55\u7684\u65f6\u5019\u5148\u7981\u7528\u5230KEYS\u540e\u9762\u518d\u5efa\u7acbKEYS,\u5177\u4f53\u8868\u73b0\u8bed\u53e5\uff1a<br style=\"color: #ff0102;\" \/> ALTER TABLE TABLE1 DISABLE KEYS;ALTER TABLE TABLE1 ENABLE KEYS103f;<br style=\"color: #ff0102;\" \/>\u800c\u5bf9\u4e8eINNNODB \u8868\u5728\u63d2\u5165\u524d\u5148 set autocommit=0;\u5b8c\u4e86\u540e\uff1aset autocommit=1;\u8fd9\u6837\u6548\u7387\u6bd4\u8f83\u9ad8\u3002\uff09<br \/>\n8).\u7ecf\u5e38OPTIMIZE TABLE \u6765\u6574\u7406\u788e\u7247.<br \/>\n9).\u8fd8\u6709\u5c31\u662fdate \u7c7b\u578b\u7684\u6570\u636e\u5982\u679c\u9891\u7e41\u8981\u505a\u6bd4\u8f83\u7684\u8bdd\u5c3d\u91cf\u4fdd\u5b58\u5728unsigned int \u7c7b\u578b\u6bd4\u8f83\u5feb\u3002<br \/>\n3.\u7cfb\u7edf\u7684\u74f6\u9888<br \/>\n1).\u78c1\u76d8\u641c\u7d22.<br \/>\n\u5e76\u884c\u641c\u7d22,\u628a\u6570\u636e\u5206\u5f00\u5b58\u653e\u5230\u591a\u4e2a\u78c1\u76d8\u4e2d\uff0c\u8fd9\u6837\u80fd\u52a0\u5feb\u641c\u7d22\u65f6\u95f4.<br \/>\n2).\u78c1\u76d8\u8bfb\u5199(IO)<br \/>\n\u53ef\u4ee5\u4ece\u591a\u4e2a\u5a92\u4ecb\u4e2d\u5e76\u884c\u7684\u8bfb\u53d6\u6570\u636e\u3002<br \/>\n3).CPU\u5468\u671f<br \/>\n\u6570\u636e\u5b58\u653e\u5728\u4e3b\u5185\u5b58\u4e2d.\u8fd9\u6837\u5c31\u5f97\u589e\u52a0CPU\u7684\u4e2a\u6570\u6765\u5904\u7406\u8fd9\u4e9b\u6570\u636e\u3002<br \/>\n4).\u5185\u5b58\u5e26\u5bbd<br \/>\n\u5f53CPU\u8981\u5c06\u66f4\u591a\u7684\u6570\u636e\u5b58\u653e\u5230CPU\u7684\u7f13\u5b58\u4e2d\u6765\u7684\u8bdd,\u5185\u5b58\u7684\u5e26\u5bbd\u5c31\u6210\u4e86\u74f6\u9888.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>\u672c\u6587\u8f7d\u81ea\uff1ahttp:\/\/blog.chinaunix.net\/u\/29134\/showart_264480.h [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[19],"tags":[37],"class_list":["post-122","post","type-post","status-publish","format-standard","hentry","category-mysql","tag-mysql"],"_links":{"self":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/122","targetHints":{"allow":["GET"]}}],"collection":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=122"}],"version-history":[{"count":0,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/122\/revisions"}],"wp:attachment":[{"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=122"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=122"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=122"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}