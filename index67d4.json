{"id":685,"date":"2014-11-14T15:56:25","date_gmt":"2014-11-14T07:56:25","guid":{"rendered":"http:\/\/ijz.me\/?p=685"},"modified":"2014-11-14T15:56:25","modified_gmt":"2014-11-14T07:56:25","slug":"%e5%a6%82%e4%bd%95%e5%88%a4%e6%96%ad-linux-%e6%98%af%e5%90%a6%e8%bf%90%e8%a1%8c%e5%9c%a8%e8%99%9a%e6%8b%9f%e6%9c%ba%e4%b8%8azz","status":"publish","type":"post","link":"http:\/\/ijz.me\/?p=685","title":{"rendered":"\u5982\u4f55\u5224\u65ad Linux \u662f\u5426\u8fd0\u884c\u5728\u865a\u62df\u673a\u4e0a\/zz\/"},"content":{"rendered":"<p><strong>\u00a0<\/strong><\/p>\n<p>\u5728 WebHostingTalk \u8bba\u575b\u4e0a\u6709\u4e9b\u56fd\u5916\u5978\u5546\u4f1a\u628a\u865a\u62df\u673a\u5f53\u4f5c\u72ec\u7acb\u670d\u52a1\u5668\u5356\uff0c\u53bb\u5e747\u6708\u4efd\u7684\u65f6\u5019\u5c31\u6709\u4e00\u4f4d\u4e2d\u56fd\u540c\u80de\u4e0a\u5f53\u53d7\u9a97\uff0c \u5e76\u5728 WHT \u4e0a\u53d1\u5e16\u58f0\u8ba8\uff0c\u8bc1\u636e\u786e\u51ff\uff0c\u751a\u81f3\u8fde\u670d\u52a1\u5546\u81ea\u5df1\u4e5f\u627f\u8ba4\uff0c\u56de\u5e16\u8fbe355\u7bc7\u3002\u8fd9\u5bb6\u72ec\u7acb\u670d\u52a1\u5668\/VPS \u63d0\u4f9b\u5546 HostATree.com \u5c45\u7136\u5927\u80c6\u7684\u628a OpenVZ VPS \u8fd9\u79cd\u4e00\u770b\u5c31\u77e5\u9053\u662f\u865a\u62df\u673a\u7684\u865a\u62df\u673a\u5f53\u4f5c\u72ec\u7acb\u670d\u52a1\u5668\u5356\uff0c\u6655\uff0c\u81f3\u5c11\u4e5f\u8981\u5f04\u4e2a VMWare\/KVM\/Xen HVM \u5427\uff08\u66f4\u96be\u53d1\u73b0\u662f\u865a\u62df\u673a\uff09\uff0c\u7528 OpenVZ \u8fd9\u79cd\u5bb9\u5668\u4e5f\u592a\u6b3a\u8d1f\u4eba\u4e86\uff1a\uff09\u6628\u5929\u6070\u597d\u6536\u5230\u7f51\u53cb\u4e00\u5c01\u90ae\u4ef6\u95ee\u5230\u4e86\u5982\u4f55\u5224\u65ad\u81ea\u5df1\u4e70\u7684\u662f\u72ec\u7acb\u670d\u52a1\u5668\u8fd8\u662f\u865a\u62df\u673a\u7684\u95ee\u9898\u3002\u8fd9\u91cc VPSee \u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u5e02\u9762\u4e0a\u5e38\u7528\u865a\u62df\u6280\u672f\uff08\u5305\u62ec\u5bb9\u5668\u6280\u672f\uff09\u7684\u5224\u522b\u5c0f\u6280\u5de7\u3002<\/p>\n<p><!--more--><\/p>\n<p><strong>\u5224\u65ad OpenVZ\/Xen PV\/UML<\/strong><\/p>\n<p>\u5224\u65ad OpenVZ\/Xen PV\/UML \u662f\u6700\u5bb9\u6613\u7684\uff0c\u76f4\u63a5\u68c0\u67e5 \/proc \u4e0b\u7684\u76f8\u5173\u76ee\u5f55\u548c\u6587\u4ef6\u5c31\u53ef\u4ee5\u77e5\u9053\uff0c\u6bd4\u5982 OpenVZ VPS \u4e0a\u4f1a\u6709 \/proc\/vz \u8fd9\u4e2a\u6587\u4ef6\uff1bXen PV \u865a\u62df\u673a\u4e0a\u4f1a\u6709 \/proc\/xen\/ \u8fd9\u4e2a\u76ee\u5f55\uff0c\u5e76\u4e14\u76ee\u5f55\u4e0b\u6709\u4e00\u4e9b\u4e1c\u897f\uff1bUML \u4e0a\u6253\u5370 \/proc\/cpuinfo \u4f1a\u627e\u5230 UML \u6807\u5fd7\u3002\u5199\u4e86\u4e00\u4e2a\u7b80\u5355\u7684 Python \u811a\u672c\u6765\u68c0\u6d4b\uff1a<\/p>\n<p>#!\/usr\/bin\/python<\/p>\n<p># check if a linux system running on a virtual machine (openvz\/xen pv\/uml)<\/p>\n<p># written by http:\/\/www.vpsee.com<\/p>\n<p>&nbsp;<\/p>\n<p>import sys, os<\/p>\n<p>&nbsp;<\/p>\n<p>def main():<\/p>\n<p>if os.getuid() != 0:<\/p>\n<p>print &#8220;must be run as root&#8221;<\/p>\n<p>sys.exit(0)<\/p>\n<p>&nbsp;<\/p>\n<p># check OpenVZ\/Virtuozzo<\/p>\n<p>if os.path.exists(&#8220;\/proc\/vz&#8221;):<\/p>\n<p>if not os.path.exists(&#8220;\/proc\/bc&#8221;):<\/p>\n<p>print &#8220;openvz container&#8221;<\/p>\n<p>else:<\/p>\n<p>print &#8220;openvz node&#8221;<\/p>\n<p>&nbsp;<\/p>\n<p># check Xen<\/p>\n<p>if os.path.exists(&#8220;\/proc\/xen\/capabilities&#8221;):<\/p>\n<p>if (os.path.getsize(&#8220;\/proc\/xen\/capabilities&#8221;) &gt; 0):<\/p>\n<p>print &#8220;xen dom0&#8221;<\/p>\n<p>else:<\/p>\n<p>print &#8220;xen domU&#8221;<\/p>\n<p>&nbsp;<\/p>\n<p># check User Mode Linux (UML)<\/p>\n<p>f = open(&#8220;\/proc\/cpuinfo&#8221;, &#8220;r&#8221;); t = f.read(); f.close()<\/p>\n<p>if (t.find(&#8220;UML&#8221;) &gt; 0):<\/p>\n<p>print &#8220;uml&#8221;<\/p>\n<p>&nbsp;<\/p>\n<p>if __name__==&#8221;__main__&#8221;:<\/p>\n<p>main()<\/p>\n<p><strong>\u5224\u65ad VMware\/Xen HVM\/KVM<\/strong><\/p>\n<p>\u5982\u679c\u4f7f\u7528\u7684\u662f VMware\/Xen HVM\/KVM \u8fd9\u6837\u7684\u5168\u865a\u62df\u5c31\u66f4\u96be\u5224\u65ad\u4e00\u4e9b\uff0c\u6700\u51c6\u786e\u7684\u529e\u6cd5\u662f\u8bfb\u53d6 CPUID \u6765\u5224\u65ad\uff0cXen \u6e90\u4ee3\u7801\u4e0b\u9762\u6709\u4e00\u6bb5\u68c0\u6d4b\u662f\u5426\u662f Xen \u7684 C \u8bed\u8a00\u4ee3\u7801 tools\/misc\/xen-detect.c\uff0c\u8fd9\u6bb5\u4ee3\u7801\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\uff0cVPSee \u91cd\u5199\u4e86\u4ee3\u7801\uff0c\u7528\u5b8f\u66ff\u4ee3\u4e86\u51fd\u6570\uff0c\u589e\u52a0\u4e86\u5bf9 VMware \u548c KVM \u7684\u8bc6\u522b\uff0c\u7528 gcc \u7f16\u8bd1\u540e\u5c31\u53ef\u4ee5\u8fd0\u884c\uff1a<\/p>\n<p>\/*<\/p>\n<p>* check if a linux system running on a virtual machine (vmware\/xen hvm\/kvm)<\/p>\n<p>* written by http:\/\/www.vpsee.com<\/p>\n<p>*\/<\/p>\n<p>#include stdio.h<\/p>\n<p>#include string.h<\/p>\n<p>&nbsp;<\/p>\n<p>#define HYPERVISOR_INFO 0x40000000<\/p>\n<p>&nbsp;<\/p>\n<p>#define CPUID(idx, eax, ebx, ecx, edx) <\/p>\n<p>asm volatile ( <\/p>\n<p>&#8220;test %1,%1 ; jz 1f ; ud2a ; .ascii &#8220;xen&#8221; ; 1: cpuid&#8221; <\/p>\n<p>: &#8220;=b&#8221; (*ebx), &#8220;=a&#8221; (*eax), &#8220;=c&#8221; (*ecx), &#8220;=d&#8221; (*edx) <\/p>\n<p>: &#8220;0&#8221; (idx) );<\/p>\n<p>&nbsp;<\/p>\n<p>int main(void)<\/p>\n<p>{<\/p>\n<p>unsigned int eax, ebx, ecx, edx;<\/p>\n<p>char string[13];<\/p>\n<p>&nbsp;<\/p>\n<p>CPUID(HYPERVISOR_INFO, &amp;eax, &amp;ebx, &amp;ecx, &amp;edx);<\/p>\n<p>*(unsigned int *)(string+0) = ebx;<\/p>\n<p>*(unsigned int *)(string+4) = ecx;<\/p>\n<p>*(unsigned int *)(string+8) = edx;<\/p>\n<p>&nbsp;<\/p>\n<p>string[12] = 0;<\/p>\n<p>if (strncmp(string, &#8220;XenVMMXenVMM&#8221;, 12) == 0) {<\/p>\n<p>printf(&#8220;xen hvmn&#8221;);<\/p>\n<p>} else if (strncmp(string, &#8220;VMwareVMware&#8221;, 12) == 0) {<\/p>\n<p>printf(&#8220;vmwaren&#8221;);<\/p>\n<p>} else if (strncmp(string, &#8220;KVMKVMKVM&#8221;, 12) == 0) {<\/p>\n<p>printf(&#8220;kvmn&#8221;);<\/p>\n<p>} else<\/p>\n<p>printf(&#8220;bare hardwaren&#8221;);<\/p>\n<p>&nbsp;<\/p>\n<p>return 0;<\/p>\n<p>}<\/p>\n<p><strong>\u5224\u65ad VirtualBox\/Virtual PC<\/strong><\/p>\n<p>\u4ec0\u4e48\uff1f\u8fd9\u79cd\u5bb6\u7528\u684c\u9762\u865a\u62df\u673a\u81ea\u5df1\u88c5\u7684\u8fd8\u4f1a\u4e0d\u77e5\u9053\uff1f\uff01\u5982\u679c\u4e0d\u77e5\u9053\u7684\u8bdd\u4e5f\u6709\u529e\u6cd5\uff0c\u5728 Linux \u4e0b\u8fd0\u884c dmidecode \u5de5\u5177\u7136\u540e\u67e5\u627e Manufacturer: innotek GmbH, Manufacturer: Microsoft Corporation \u5173\u952e\u5b57\u5c31\u80fd\u5bf9\u5e94\u4e0a VirtualBox \u548c Virtual PC.<\/p>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>\u00a0 \u5728 WebHostingTalk \u8bba\u575b\u4e0a\u6709\u4e9b\u56fd\u5916\u5978\u5546\u4f1a\u628a\u865a\u62df\u673a\u5f53\u4f5c\u72ec\u7acb\u670d\u52a1\u5668\u5356\uff0c\u53bb\u5e747\u6708\u4efd\u7684\u65f6\u5019\u5c31\u6709\u4e00\u4f4d\u4e2d [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[2,10,14],"tags":[36],"class_list":["post-685","post","type-post","status-publish","format-standard","hentry","category-linux","category-10","category-14","tag-linux"],"_links":{"self":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/685","targetHints":{"allow":["GET"]}}],"collection":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=685"}],"version-history":[{"count":0,"href":"http:\/\/ijz.me\/index.php?rest_route=\/wp\/v2\/posts\/685\/revisions"}],"wp:attachment":[{"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=685"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=685"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/ijz.me\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=685"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}